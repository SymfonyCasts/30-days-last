# Fancier Toasts

Coming soon...

Thanks to our work yesterday on day 16, we have a really nice Toast notification that's powered entirely via CSS and just a tiny bit of JavaScript to, boop, close it. Today we're going to take this to the next level because I really want Toast notification to be a rich part of our site. And the first thing we're going to do is add an auto-close. It's pretty common for these Toast notifications to hide themselves after maybe 5 seconds. But I also want to keep my closeable controller reusable. There may be other parts of my site where I want to close something, but I don't want it to automatically close. So we're going to allow this to be an option that we can pass in. And the way you pass things into a controller is via values. So I'm going to say static values equals. And we're going to invent a new value here called auto-close, which is going to be a number. Now, in a connect method, the idea here is that if we have this .auto-close value, which is how you reference the value for this auto-close, then that's actually perfect. We'll just use a little setTimeout. So this looks good. So the next step is to go to our specific usage of this controller over in underscore flashes.html twig and pass in this new auto-close value. We do that on the same element as the data-controller. And the value here is going to be data-closeable-auto-close-value equals. And let's use 5,000 for 5 seconds. So the format here is data-the name of the controller-auto-close. That's the name of the value, auto-close. But because we're in an HTML attribute, we use the dash case here. Then the word dash-value equals. And finally, what we want to pass in. The format here is a bit harder to remember than just data-controller. But as you saw, if you have this stimulus plugin for PhpStorm, it auto-completes it for you, which helps a lot. All right, so let's try this. Let's go here, edit this, save, and 1, 2, 3, 4, 5. Boom, got it. All right. Should we make it... We might want to make it more obvious that the toast notification is going to close after 5 seconds. What I'm thinking is a little animation here of a bar that gets smaller and smaller, and then finally disappears right as the toast closes itself. So cool.  Let's add this. And once again, we're going to make this configurable. So the idea is that we're going to add a little bar down here, and then we're going to animate its width from 100% to 0% over those 5 seconds. To be able to find that element instead of our controller, we're going to use a target. So static targets equals timer bar. And then down here in connect, we'll just check for that. So we can see if we have one by saying if this.hasTimerBarTarget, then we basically want to say this.TimerBarTarget.style.width equals 0. So we'll start at full, and then immediately if we have that target, we'll set it to 0. And as long as we have some CSS transition set up on that element, we should see that transition happen over time. But we are going to do one small change here. We're going to use a little setTimeout and put it inside of there with a little 10-millisecond delay. This is going to allow the element to establish itself on the page with a full 100% width, and then 10 milliseconds later, we will change it to 0, and CSS will see that change and start the CSS transition. Now for the timer bar itself, let's add that. So at the bottom of underscore flashes, I am going to just paste something. So we're absolutely positioning this. We're giving it a height, background green. And the really important thing is that we're going to do our transition, and we're going to have the transition last for 5,000 milliseconds. Also, w-full is going to establish this as a width of 100%. And then finally, to make this a target, we can say data-closable target equals timer bar. All right, let's see what this looks like. Hit edit, save, and it opens, but there was no animation on it. Let's do some debugging here. So I don't see any errors in my console. And there's the problem right there. I should have listened to my editor. Timer bar target. There we go, let's close this. Save. That's what I want to see. And right as it gets to 0, boop, it ends. All right, so this is nice, but there's one more detail that I'm going to want on my toast notification, and that is that no matter how it closes, I want it to fade out instead of, boom, happening automatically.  Now, fading things out is a bit tricky. You can use CSS transitions, and we will, to go from opacity 100 to 0. But then you need some JavaScript to wait for that CSS transition to finish so that it can finally remove the element from the page. To help us with this, we're going to use a library called stimulus-use. Stimulus components, we saw earlier, is a list of reusable stimulus controllers. Stimulus-use is a bunch of behaviors that you can add to your stimulus controllers. Lots of good stuff here. And the one we're going to use is called use-transition. So step one, let's get this installed. So we'll run bin console, import map requires stimulus-use. Awesome. And then over in our controller, we can import that with import use-transition. From stimulus-use. And the way you use these behaviors is you say use-transition, you pass this, and then you pass some options that are going to be specific to this. And I am just going to paste those in. So what this means is that while an element is leaving or hiding, this library is going to add these three classes to that element. That's going to establish that we want the element to have a 200 millisecond transition. The leave from means that at the moment it starts hiding, it's going to give it this opacity 100. Then one millisecond later, it's going to remove this class, add opacity zero. That change will trigger the 200 millisecond transition. Finally, the transition true is a way for us to tell the library that we are starting in a visible state because you can also use this behavior to start hidden and then show your element. When you use use-transition, what it gives us in our controller are two new methods called leave and enter. So now down here in close, instead of removing the element ourselves, we'll say this.leave. All right, let's try this. Spin over, refresh, and save. And watch this. Ah, it was quick, but that is exactly what we want to see. I love it. All right, tomorrow we're going to explore what happens when we put an HTML form inside of a frame. This will lead us to turbo streams and eventually modals.
