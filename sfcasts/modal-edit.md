# More with fun Modals! Editing & Deleting

Coming soon...

So if our new modal system is so reusable, we should be able to open the edit form in a modal really easily, right? Well, the only thing we need to do in edit.html.twig is opt into the modal system by changing modal-base.html.twig. And while I'm here, let's take out this extra margin. So we'll add modal-m0 and modal-p0. Cool. Next, we're going to make this edit link target the modal frame. So this lives in underscore row.html.twig. Here it is. I'll break this link onto multiple lines so we can see it better. And we'll add data turbo frame equals edit equals modal. All right, moment of truth. Refresh. And darn it, it just works. And if we save successfully, even that works. We get the toast. The modal closes. My goodness. This works because in Voyage Controller, the edit action, like the new action, redirects over to the index page. So that has an empty modal frame. So that closes the modal. Everything works beautifully. But I want to be tricky. Remember, the edit form now appears in two contexts, the modal, but also on a standalone page. What if when we're on this standalone page, on success, instead of redirecting to the index page, we actually want to redirect right back here so we can keep editing. So this is easy to do. Let's just change the route to app voyage edit. And then set ID to voyage arrow get ID. Awesome. So now if I save this, that works awesomely. But I bet you can guess weird things are going to happen over here. So when I edit, I hit save and nothing happens. The modal's still here and there's no toast notification. So I want to work on that missing toast notification first. Over in base.html twig, instead of our modal frame, we render the flash messages in a turbo stream. Well, the problem is in the edit page, when we redirect to the edit page, because it extends modal base.html twig, what's being returned on success is actually this turbo frame. And this turbo frame does not render these same streams. So we don't see the flash message. So it turns out that these lines here, we should really put these inside any turbo frame that might have a form in it. Form in it.  So to help that, I'm going to copy this and inside the templates directory, create a new file called underscore frame success stream.html.twig. And I'm going to paste that. Cool. Now, before I go start using this, I'm going to add one other little detail here. An if statement that says if app.request.headers.get turbo frame equals a new frame variable, then we're going to render this. Else, we're not going to. So the reason I have this is that the reason we're adding this is if we, for example, have multiple turbo frames on the page that all include this partial, whichever one is rendered first is going to render all of the flash messages. We don't want that. So in case there's a turbo frame up here that includes a partial, we're only going to render anything in here if that frame is the current frame. So watch how we use this. Down here, I'll delete those and we'll say curly curly include underscore frame success stream.html.twig. And then we'll pass frame set to modal. So only if we are actually submitting inside of the modal frame will we go and render the success stream messages right here. Because if we're not, we want to leave those stream messages for whatever part of our page, whatever frame in our page is actually being used right now. So I'll copy this and let's go into modal.frame.html.twig. And I'm going to paste it there as well. So if we go over here, I'll refresh, I'll hit edit and save. The modal stays open, but look back here, we can see the turbo, we can see the toast. So yay. Now about this, so how do we close this modal? Now, again, when we start loading a form inside of a frame, when we start loading a form inside of a modal, our symphony controller, let me close a few things, might not need to change. Might not need to change. Flash messages work. And depending on where you redirect to, the modal might even close. But this is an example of asking yourself, where is my form going to be used? And in the context of a modal right now, it's not working correctly. And that's okay. This is one of those extra changes we're going to make.  So check this out. In new.html.twig, let's steal the stream success from the bottom. And in edit.html.twig, we will paste that. What we want to do in this case is update the turbo frame ID equals modal to empty its content so that the modal will close. So we can do that by saying action equals update and then target equals modal. And then in the template, we will update it with nothing. Now in our controller to kind of add that extra stuff, we'll copy the if statement from our new action down here, right before we set the flash. We'll paste that, change the template to edit.html.twig and we should be good. So this time when we hit edit, when we hit save, that is going to redirect back to the edit page and that is going to have a modal frame with this content. But because of that extra stream, the modal will immediately be emptied and it should close. So watch.

It doesn't close, so let me go look at my stream here, make sure I have everything correct. And ah, here's the problem. When you target, you use a CSS selector, when it's target, it's just the ID. So this turbo stream wasn't matching anything, it wasn't doing anything, so let's try it again. And got it. Now, speaking of our controller doing extras, a really cool thing here would be that when we make a change to this form, it automatically updates this row right here. So cool, we can totally do that. First, to target this in underscore row dot h to my twig, let's add an ID, we'll call it voyage list item dash, and then curly, curly voyage list item dash. Voyage dot ID. Perfect. And I'll copy that, and we'll head over to edit dot h to my twig, and we'll just add one more turbo stream here. Turbo stream action equals replace, and then target equals voyage list item voyage ID, and we'll do our template, and inside we can just call that voyage slash underscore row dot h to my twig. So this is where things really start to shine, because I can edit this, remove those exclamation points, and the page updates instantly. All right, the last thing I wanna talk about here is this delete. It actually works, it almost works perfectly. When I hit delete, look, the modal closes, we get the flash message. And the reason is, like our other actions, after delete happens, it redirects back to our index page, the empty modal frame over there closes it, the flash message works, it's all great, except for one small detail. The item on the row is still there until we refresh. Now we actually have two options here. First, I wanna point out that the delete button is actually a form that submits, and the only reason this is submitting inside of a TurboFrame is because we're inside of the modal. But the delete action doesn't really need to submit inside the frame. It's not like we're gonna get validation errors that we need to reload inside of this modal. So the easiest option is to go into the delete form and add a data TurboFrame equals underscore top. So this is gonna work really nicely.  We can hit edit, we can hit delete, and it's just a full page reload, full page navigation, which is great. Now, if you wanna get really technical about how smooth it is, if you scroll down a little bit and delete one, it's gonna scroll back up to the top because it's a full navigation. So if you wanna make it really, really shine, you can. We can remove that data TurboFrame equals top. And now, like any other form that exists in the TurboFrame, we need to ask, where is this form being used and what do I need to update to make the page really, really nice? In this case, we need to remove the row. So this is another extra thing we're gonna do after we handle this form submit. So inside of edit.html twig, let's steal this stream success. And then we're gonna create a new template here called delete.html twig. Now, delete doesn't normally have its own templates, and we're just gonna use this for the stream success. And what we'll use is this one. We'll change action equals remove and target equals voyage list item dash. And here, just use an ID variable. And for the template, we don't even need that. This is just going to remove that element. Now, inside of VoyageController, scroll up. Let's steal our if statement and down in delete, let's paste that. And in this case, change the template to delete. And in this case, we're gonna pass an ID variable and set that to ID. We can't use voyage arrow get ID here because it'll already be empty because we deleted it. So instead, pass an ID here. And then right before we delete it, we'll say ID equals voyage arrow get ID. All right, this time, I'm gonna scroll way down here. Let's delete ID 22. Watch. Boom. The row is gone, we get the toast notification, but it doesn't move around all over the place. All right, wow, what a few days. Tomorrow, we're gonna take it a little bit easier and learn one other way we can use TurboStreams in situations where we need ultimate control. See you then.
